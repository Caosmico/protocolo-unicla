<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Constructor de Protocolo de Investigaci√≥n UNICLA - Con Retroalimentaci√≥n Interdisciplinaria</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #003d7a 0%, #0056a8 100%);
            min-height: 100vh;
            padding: 20px;
        }

        /* Estilos para pantalla de login */
        .login-container {
            max-width: 450px;
            margin: 100px auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-header {
            background: linear-gradient(135deg, #003d7a 0%, #0056a8 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .login-header img {
            max-width: 250px;
            margin-bottom: 20px;
        }

        .login-header h2 {
            font-size: 1.8em;
            margin-bottom: 10px;
        }

        .login-header p {
            opacity: 0.9;
            font-size: 1em;
        }

        .login-body {
            padding: 40px 30px;
        }

        .login-form-group {
            margin-bottom: 25px;
        }

        .login-form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 600;
            font-size: 1em;
        }

        .login-form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .login-form-group input:focus {
            outline: none;
            border-color: #003d7a;
        }

        .login-btn {
            width: 100%;
            background: linear-gradient(135deg, #003d7a 0%, #0056a8 100%);
            color: white;
            border: none;
            padding: 15px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 600;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 61, 122, 0.4);
        }

        .login-error {
            background: #ffebee;
            color: #c62828;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #c62828;
            display: none;
        }

        .login-error.show {
            display: block;
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .user-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info-text {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-info-text strong {
            color: #003d7a;
            font-size: 1.1em;
        }

        .logout-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: #d32f2f;
        }

        .login-info {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
        }

        .login-info h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .login-info ul {
            margin-left: 20px;
            color: #856404;
        }

        .login-info ul li {
            margin: 5px 0;
        }

        .hidden {
            display: none;
        }
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #003d7a 0%, #0056a8 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header img {
            max-width: 300px;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #003d7a;
        }

        .section-title {
            color: #003d7a;
            font-size: 1.8em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .section-number {
            background: #003d7a;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 600;
            font-size: 1.1em;
        }

        .help-text {
            font-size: 0.9em;
            color: #666;
            font-style: italic;
            margin-bottom: 8px;
        }

        input[type="text"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #003d7a;
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        input[type="radio"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .btn {
            background: linear-gradient(135deg, #003d7a 0%, #0056a8 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin: 10px 10px 10px 0;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 61, 122, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #52a8e3 0%, #3498db 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            position: relative;
            padding-right: 50px;
        }

        .btn-warning .toggle-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            transition: transform 0.3s ease;
            font-size: 1.2em;
        }

        .btn-warning.active .toggle-icon {
            transform: translateY(-50%) rotate(180deg);
        }

        .feedback-box {
            background: #e8f5e9;
            border-left: 5px solid #4caf50;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transition: max-height 0.5s ease, opacity 0.5s ease, margin-top 0.5s ease, padding 0.5s ease;
        }

        .feedback-box.show {
            max-height: 3000px;
            opacity: 1;
            margin-top: 20px;
            padding: 20px;
            animation: slideIn 0.5s ease;
        }

        .feedback-box:not(.show) {
            padding: 0;
            margin-top: 0;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .feedback-title {
            font-weight: bold;
            color: #2e7d32;
            font-size: 1.2em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .feedback-icon {
            margin-right: 10px;
            font-size: 1.5em;
        }

        .perspective-container {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .perspective {
            background: #f9f9f9;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 3px solid #003d7a;
        }

        .perspective-title {
            font-weight: bold;
            color: #003d7a;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .discipline-badge {
            display: inline-block;
            background: #003d7a;
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            margin-right: 5px;
            margin-bottom: 5px;
        }

        .perspective-content {
            color: #333;
            line-height: 1.6;
            margin-top: 10px;
        }

        .reference {
            font-size: 0.9em;
            color: #555;
            font-style: italic;
            margin-top: 12px;
            padding-left: 15px;
            border-left: 2px solid #003d7a;
            background: #fafafa;
            padding: 10px 15px;
        }

        .methodology-section {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .methodology-title {
            color: #856404;
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .hidden {
            display: none;
        }

        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        /* Estilos para la portada */
        .portada {
            page-break-after: always;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 30px 40px;
            background: white;
        }

        .portada-header {
            text-align: center;
            padding: 10px 0;
        }

        .portada-header img {
            max-width: 400px;
            margin-bottom: 15px;
            background: transparent;
        }

        .portada-header h2 {
            font-size: 1.6em;
            color: #003d7a;
            font-weight: bold;
            margin: 10px 0;
        }

        .portada-header p {
            font-size: 1.1em;
            color: #555;
            margin: 5px 0;
        }

        .portada-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }

        .portada-titulo {
            font-size: 1.6em;
            color: #003d7a;
            font-weight: bold;
            margin: 20px 0;
            text-transform: uppercase;
            line-height: 1.3;
        }

        .portada-subtitulo {
            font-size: 1.3em;
            color: #555;
            margin: 15px 0;
        }

        .portada-datos {
            margin: 20px 0;
            text-align: left;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .portada-datos p {
            margin: 8px 0;
            font-size: 1.05em;
            color: #333;
        }

        .portada-datos .label {
            font-weight: bold;
            color: #003d7a;
        }

        .portada-datos-institucionales {
            margin: 15px 0;
            text-align: center;
        }

        .portada-datos-institucionales p {
            font-size: 1.05em;
            color: #555;
        }

        .portada-pie {
            text-align: center;
            color: #666;
            font-size: 1.05em;
            padding: 10px 0;
        }

        .portada-pie .fecha {
            margin-top: 8px;
            font-weight: bold;
        }

        /* Estilos para el contenido del protocolo */
        .protocolo-content {
            padding: 40px;
            line-height: 1.8;
        }

        .protocolo-content h1 {
            color: #003d7a;
            text-align: center;
            margin-bottom: 40px;
            font-size: 2em;
            text-transform: uppercase;
        }

        .protocolo-content h2 {
            color: #003d7a;
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 1.6em;
            border-bottom: 2px solid #003d7a;
            padding-bottom: 5px;
        }

        .protocolo-content h3 {
            color: #0056a8;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .protocolo-content p {
            margin-bottom: 15px;
            text-align: justify;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .form-area, .action-buttons, .header {
                display: none !important;
            }
            
            .container {
                box-shadow: none;
                border-radius: 0;
            }
            
            .portada {
                page-break-after: always;
            }
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .info-box-title {
            font-weight: bold;
            color: #1976D2;
            margin-bottom: 8px;
        }

        .interdisciplinary-analysis {
            background: #f5f5f5;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .interdisciplinary-title {
            color: #003d7a;
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 3px solid #003d7a;
            padding-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- PANTALLA DE LOGIN -->
    <div id="loginScreen" class="login-container">
        <div class="login-header">
            <img src="logo_unicla.png" alt="UNICLA Logo">
            <h2>Bienvenido</h2>
            <p>Constructor de Protocolo de Investigaci√≥n</p>
        </div>
        
        <div class="login-body">
            <div id="loginError" class="login-error">
                Usuario o contrase√±a incorrectos
            </div>
            
            <form id="loginForm" onsubmit="login(event)">
                <div class="login-form-group">
                    <label for="username">üë§ Usuario:</label>
                    <input type="text" id="username" placeholder="Ingrese su usuario" required autocomplete="username">
                </div>
                
                <div class="login-form-group">
                    <label for="password">üîí Contrase√±a:</label>
                    <input type="password" id="password" placeholder="Ingrese su contrase√±a" required autocomplete="current-password">
                </div>
                
                <button type="submit" class="login-btn">Iniciar Sesi√≥n</button>
            </form>
            
            <div class="login-info">
                <h4>üë• Usuarios de Demostraci√≥n:</h4>
                <ul>
                    <li><strong>Usuario:</strong> oscar | <strong>Contrase√±a:</strong> unicla2025</li>
                    <li><strong>Usuario:</strong> profesor | <strong>Contrase√±a:</strong> profesor123</li>
                    <li><strong>Usuario:</strong> estudiante | <strong>Contrase√±a:</strong> estudiante123</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- CONTENEDOR PRINCIPAL (oculto hasta login) -->
    <div class="container hidden" id="mainContainer">
        <div class="header">
            <h1>üìã Constructor de Protocolo de Investigaci√≥n</h1>
            <p>Universidad Contempor√°nea de las Am√©ricas - UNICLA</p>
            <p>Con Retroalimentaci√≥n Interdisciplinaria Basada en Hern√°ndez-Sampieri</p>
        </div>

        <div class="user-info">
            <div class="user-info-text">
                <span>üë§</span>
                <span>Usuario: <strong id="displayUsername"></strong></span>
            </div>
            <button class="logout-btn" onclick="logout()">Cerrar Sesi√≥n</button>
        </div>

        <div class="form-area">
            <div class="content">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill">0%</div>
                </div>

                <!-- SECCI√ìN 0: DATOS INSTITUCIONALES -->
                <div class="section">
                    <div class="section-title">
                        <span class="section-number">üìë</span>
                        <span>Datos Institucionales (Para Portada)</span>
                    </div>

                    <div class="form-group">
                        <label for="institucion">Instituci√≥n:</label>
                        <input type="text" id="institucion" placeholder="Universidad Contempor√°nea de las Am√©ricas" value="Universidad Contempor√°nea de las Am√©ricas">
                    </div>

                    <div class="form-group">
                        <label for="facultad">Campus:</label>
                        <input type="text" id="facultad" placeholder="Ej: Campus Norte">
                    </div>

                    <div class="form-group">
                        <label for="programa">Programa Acad√©mico:</label>
                        <input type="text" id="programa" placeholder="Ej: Maestr√≠a en Investigaci√≥n Social">
                    </div>

                    <div class="form-group">
                        <label for="autor">Autor(es):</label>
                        <input type="text" id="autor" placeholder="Nombre completo del autor">
                    </div>

                    <div class="form-group">
                        <label for="director">Director de Tesis (opcional):</label>
                        <input type="text" id="director" placeholder="Nombre del director de tesis">
                    </div>

                    <div class="form-group">
                        <label for="linea">L√≠nea de Investigaci√≥n (opcional):</label>
                        <input type="text" id="linea" placeholder="Ej: Metodolog√≠a de la Investigaci√≥n Social">
                    </div>

                    <div class="form-group">
                        <label for="ciudad">Ciudad:</label>
                        <input type="text" id="ciudad" placeholder="Ej: Ciudad de M√©xico">
                    </div>

                    <div class="form-group">
                        <label for="estado">Estado, Pa√≠s:</label>
                        <input type="text" id="estado" placeholder="Ej: M√©xico">
                    </div>

                    <div class="form-group">
                        <label for="fecha">Fecha (Mes y A√±o):</label>
                        <input type="text" id="fecha" placeholder="Ej: Noviembre 2025">
                    </div>
                </div>

                <!-- SECCI√ìN 1: PLANTEAMIENTO DEL PROBLEMA -->
                <div class="section">
                    <div class="section-title">
                        <span class="section-number">1</span>
                        <span>Planteamiento del Problema</span>
                    </div>

                    <div class="form-group">
                        <label for="titulo">T√≠tulo de la Investigaci√≥n:</label>
                        <div class="help-text">Debe ser claro, preciso y reflejar el contenido de la investigaci√≥n</div>
                        <input type="text" id="titulo" placeholder="Ej: An√°lisis del impacto de las tecnolog√≠as digitales en...">
                        <button class="btn btn-warning" onclick="solicitarRetroalimentacion('titulo', event)">
                            üîç Obtener Retroalimentaci√≥n
                            <span class="toggle-icon">‚ñº</span>
                        </button>
                    </div>
                    <div id="feedback-titulo" class="feedback-box"></div>

                    <div class="form-group">
                        <label for="antecedentes">Antecedentes del Problema:</label>
                        <div class="help-text">Contexto hist√≥rico y estudios previos relacionados</div>
                        <textarea id="antecedentes" placeholder="Describa los antecedentes relevantes del problema..."></textarea>
                        <button class="btn btn-warning" onclick="solicitarRetroalimentacion('antecedentes', event)">üîç Obtener Retroalimentaci√≥n
                            <span class="toggle-icon">‚ñº</span></button>
                    </div>
                    <div id="feedback-antecedentes" class="feedback-box"></div>

                    <div class="form-group">
                        <label for="descripcionProblema">Descripci√≥n del Problema:</label>
                        <div class="help-text">Describa claramente el problema de investigaci√≥n</div>
                        <textarea id="descripcionProblema" placeholder="¬øCu√°l es la situaci√≥n problem√°tica que se va a investigar?"></textarea>
                        <button class="btn btn-warning" onclick="solicitarRetroalimentacion('descripcionProblema', event)">üîç Obtener Retroalimentaci√≥n
                            <span class="toggle-icon">‚ñº</span></button>
                    </div>
                    <div id="feedback-descripcionProblema" class="feedback-box"></div>

                    <div class="form-group">
                        <label for="preguntaPrincipal">Pregunta de Investigaci√≥n Principal:</label>
                        <div class="help-text">La pregunta central que guiar√° toda la investigaci√≥n</div>
                        <input type="text" id="preguntaPrincipal" placeholder="¬øCu√°l es...? ¬øDe qu√© manera...? ¬øC√≥mo...?">
                        <button class="btn btn-warning" onclick="solicitarRetroalimentacion('preguntaPrincipal', event)">üîç Obtener Retroalimentaci√≥n
                            <span class="toggle-icon">‚ñº</span></button>
                    </div>
                    <div id="feedback-preguntaPrincipal" class="feedback-box"></div>

                    <div class="form-group">
                        <label for="preguntasEspecificas">Preguntas Espec√≠ficas (una por l√≠nea):</label>
                        <textarea id="preguntasEspecificas" placeholder="1. ¬øCu√°les son...?
2. ¬øDe qu√© manera...?
3. ¬øC√≥mo se relaciona...?"></textarea>
                        <button class="btn btn-warning" onclick="solicitarRetroalimentacion('preguntasEspecificas', event)">üîç Obtener Retroalimentaci√≥n
                            <span class="toggle-icon">‚ñº</span></button>
                    </div>
                    <div id="feedback-preguntasEspecificas" class="feedback-box"></div>
                </div>

                <!-- SECCI√ìN 2: OBJETIVOS -->
                <div class="section">
                    <div class="section-title">
                        <span class="section-number">2</span>
                        <span>Objetivos de la Investigaci√≥n</span>
                    </div>

                    <div class="form-group">
                        <label for="objetivoGeneral">Objetivo General:</label>
                        <div class="help-text">Debe iniciar con un verbo en infinitivo (Analizar, Determinar, Evaluar...)</div>
                        <textarea id="objetivoGeneral" placeholder="Analizar/Determinar/Evaluar..."></textarea>
                        <button class="btn btn-warning" onclick="solicitarRetroalimentacion('objetivoGeneral', event)">üîç Obtener Retroalimentaci√≥n
                            <span class="toggle-icon">‚ñº</span></button>
                    </div>
                    <div id="feedback-objetivoGeneral" class="feedback-box"></div>

                    <div class="form-group">
                        <label for="objetivosEspecificos">Objetivos Espec√≠ficos (uno por l√≠nea):</label>
                        <textarea id="objetivosEspecificos" placeholder="1. Identificar...
2. Describir...
3. Comparar..."></textarea>
                        <button class="btn btn-warning" onclick="solicitarRetroalimentacion('objetivosEspecificos', event)">üîç Obtener Retroalimentaci√≥n
                            <span class="toggle-icon">‚ñº</span></button>
                    </div>
                    <div id="feedback-objetivosEspecificos" class="feedback-box"></div>
                </div>

                <!-- SECCI√ìN 3: JUSTIFICACI√ìN -->
                <div class="section">
                    <div class="section-title">
                        <span class="section-number">3</span>
                        <span>Justificaci√≥n</span>
                    </div>

                    <div class="form-group">
                        <label for="relevanciaTeorica">Relevancia Te√≥rica:</label>
                        <div class="help-text">¬øQu√© aporta la investigaci√≥n al conocimiento te√≥rico?</div>
                        <textarea id="relevanciaTeorica" placeholder="La investigaci√≥n contribuye al conocimiento..."></textarea>
                        <button class="btn btn-warning" onclick="solicitarRetroalimentacion('relevanciaTeorica', event)">üîç Obtener Retroalimentaci√≥n
                            <span class="toggle-icon">‚ñº</span></button>
                    </div>
                    <div id="feedback-relevanciaTeorica" class="feedback-box"></div>

                    <div class="form-group">
                        <label for="relevanciaPractica">Relevancia Pr√°ctica y Social:</label>
                        <div class="help-text">¬øQu√© utilidad pr√°ctica tiene? ¬øA qui√©n beneficia?</div>
                        <textarea id="relevanciaPractica" placeholder="Los resultados permitir√°n..."></textarea>
                        <button class="btn btn-warning" onclick="solicitarRetroalimentacion('relevanciaPractica', event)">üîç Obtener Retroalimentaci√≥n
                            <span class="toggle-icon">‚ñº</span></button>
                    </div>
                    <div id="feedback-relevanciaPractica" class="feedback-box"></div>

                    <div class="form-group">
                        <label for="relevanciaMetodologica">Relevancia Metodol√≥gica (opcional):</label>
                        <div class="help-text">¬øSe proponen nuevos m√©todos o instrumentos?</div>
                        <textarea id="relevanciaMetodologica" placeholder="Se desarrollar√° un instrumento/m√©todo..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="viabilidad">Viabilidad:</label>
                        <div class="help-text">¬øEs factible realizar la investigaci√≥n? (Recursos, tiempo, acceso)</div>
                        <textarea id="viabilidad" placeholder="La investigaci√≥n es viable porque..."></textarea>
                        <button class="btn btn-warning" onclick="solicitarRetroalimentacion('viabilidad', event)">üîç Obtener Retroalimentaci√≥n
                            <span class="toggle-icon">‚ñº</span></button>
                    </div>
                    <div id="feedback-viabilidad" class="feedback-box"></div>
                </div>

                <!-- SECCI√ìN 4: MARCO TE√ìRICO -->
                <div class="section">
                    <div class="section-title">
                        <span class="section-number">4</span>
                        <span>Marco Te√≥rico y Conceptual</span>
                    </div>

                    <div class="form-group">
                        <label for="teorias">Teor√≠as y Enfoques Principales:</label>
                        <div class="help-text">Teor√≠as que fundamentan su investigaci√≥n</div>
                        <textarea id="teorias" placeholder="La investigaci√≥n se fundamenta en..."></textarea>
                        <button class="btn btn-warning" onclick="solicitarRetroalimentacion('teorias', event)">üîç Obtener Retroalimentaci√≥n
                            <span class="toggle-icon">‚ñº</span></button>
                    </div>
                    <div id="feedback-teorias" class="feedback-box"></div>

                    <div class="form-group">
                        <label for="literatura">Revisi√≥n de Literatura:</label>
                        <div class="help-text">Principales estudios y hallazgos previos</div>
                        <textarea id="literatura" placeholder="Estudios previos han demostrado..."></textarea>
                        <button class="btn btn-warning" onclick="solicitarRetroalimentacion('literatura', event)">üîç Obtener Retroalimentaci√≥n
                            <span class="toggle-icon">‚ñº</span></button>
                    </div>
                    <div id="feedback-literatura" class="feedback-box"></div>

                    <div class="form-group">
                        <label for="conceptos">Conceptos Clave (uno por l√≠nea):</label>
                        <div class="help-text">Defina los conceptos centrales de su investigaci√≥n</div>
                        <textarea id="conceptos" placeholder="1. Concepto A: Definici√≥n...
2. Concepto B: Definici√≥n..."></textarea>
                    </div>
                </div>

                <!-- SECCI√ìN 5: METODOLOG√çA -->
                <div class="section">
                    <div class="section-title">
                        <span class="section-number">5</span>
                        <span>Metodolog√≠a</span>
                    </div>

                    <div class="form-group">
                        <label>Enfoque Metodol√≥gico:</label>
                        <div class="help-text">Seleccione el enfoque de su investigaci√≥n</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="cuantitativo" name="enfoque" value="cuantitativo" onchange="mostrarEnfoque()">
                                <label for="cuantitativo">Cuantitativo</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="cualitativo" name="enfoque" value="cualitativo" onchange="mostrarEnfoque()">
                                <label for="cualitativo">Cualitativo</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="mixto" name="enfoque" value="mixto" onchange="mostrarEnfoque()">
                                <label for="mixto">Mixto</label>
                            </div>
                        </div>
                        <button class="btn btn-warning" onclick="solicitarRetroalimentacion('enfoque', event)">üîç Obtener Retroalimentaci√≥n
                            <span class="toggle-icon">‚ñº</span></button>
                    </div>
                    <div id="feedback-enfoque" class="feedback-box"></div>

                    <div id="infoEnfoque" class="info-box hidden">
                        <div class="info-box-title">Caracter√≠sticas del enfoque seleccionado:</div>
                        <p id="descripcionEnfoque"></p>
                    </div>

                    <div class="form-group">
                        <label for="alcance">Alcance del Estudio:</label>
                        <select id="alcance">
                            <option value="">Seleccione un alcance</option>
                            <option value="exploratorio">Exploratorio</option>
                            <option value="descriptivo">Descriptivo</option>
                            <option value="correlacional">Correlacional</option>
                            <option value="explicativo">Explicativo</option>
                        </select>
                        <button class="btn btn-warning" onclick="solicitarRetroalimentacion('alcance', event)">üîç Obtener Retroalimentaci√≥n
                            <span class="toggle-icon">‚ñº</span></button>
                    </div>
                    <div id="feedback-alcance" class="feedback-box"></div>

                    <div class="form-group">
                        <label for="diseno">Dise√±o de Investigaci√≥n:</label>
                        <div class="help-text">Experimental, no experimental, etc.</div>
                        <textarea id="diseno" placeholder="El dise√±o es... porque..."></textarea>
                        <button class="btn btn-warning" onclick="solicitarRetroalimentacion('diseno', event)">üîç Obtener Retroalimentaci√≥n
                            <span class="toggle-icon">‚ñº</span></button>
                    </div>
                    <div id="feedback-diseno" class="feedback-box"></div>
                </div>

                <!-- SECCI√ìN 6: HIP√ìTESIS (Condicional) -->
                <div class="section" id="seccionHipotesis" style="display:none;">
                    <div class="section-title">
                        <span class="section-number">6</span>
                        <span>Hip√≥tesis y Variables</span>
                    </div>

                    <div class="form-group">
                        <label for="hipotesisInvestigacion">Hip√≥tesis de Investigaci√≥n:</label>
                        <textarea id="hipotesisInvestigacion" placeholder="A mayor X, mayor Y..."></textarea>
                        <button class="btn btn-warning" onclick="solicitarRetroalimentacion('hipotesisInvestigacion', event)">üîç Obtener Retroalimentaci√≥n
                            <span class="toggle-icon">‚ñº</span></button>
                    </div>
                    <div id="feedback-hipotesisInvestigacion" class="feedback-box"></div>

                    <div class="form-group">
                        <label for="hipotesisNula">Hip√≥tesis Nula:</label>
                        <textarea id="hipotesisNula" placeholder="No existe relaci√≥n entre X y Y..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="hipotesisAlternativa">Hip√≥tesis Alternativa:</label>
                        <textarea id="hipotesisAlternativa" placeholder="A menor X, mayor Y..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="variables">Variables (una por l√≠nea):</label>
                        <textarea id="variables" placeholder="Variable independiente: X
Variable dependiente: Y
Variables control: Z1, Z2"></textarea>
                        <button class="btn btn-warning" onclick="solicitarRetroalimentacion('variables', event)">üîç Obtener Retroalimentaci√≥n
                            <span class="toggle-icon">‚ñº</span></button>
                    </div>
                    <div id="feedback-variables" class="feedback-box"></div>
                </div>

                <!-- SECCI√ìN 7: POBLACI√ìN Y MUESTRA -->
                <div class="section">
                    <div class="section-title">
                        <span class="section-number">7</span>
                        <span>Poblaci√≥n y Muestra</span>
                    </div>

                    <div class="form-group">
                        <label for="poblacion">Poblaci√≥n:</label>
                        <div class="help-text">Describa el universo de estudio</div>
                        <textarea id="poblacion" placeholder="La poblaci√≥n est√° constituida por..."></textarea>
                        <button class="btn btn-warning" onclick="solicitarRetroalimentacion('poblacion', event)">üîç Obtener Retroalimentaci√≥n
                            <span class="toggle-icon">‚ñº</span></button>
                    </div>
                    <div id="feedback-poblacion" class="feedback-box"></div>

                    <div class="form-group">
                        <label for="tipoMuestreo">Tipo de Muestreo:</label>
                        <select id="tipoMuestreo">
                            <option value="">Seleccione un tipo</option>
                            <option value="probabilistico">Probabil√≠stico</option>
                            <option value="no-probabilistico">No probabil√≠stico</option>
                        </select>
                        <button class="btn btn-warning" onclick="solicitarRetroalimentacion('tipoMuestreo', event)">üîç Obtener Retroalimentaci√≥n
                            <span class="toggle-icon">‚ñº</span></button>
                    </div>
                    <div id="feedback-tipoMuestreo" class="feedback-box"></div>

                    <div class="form-group">
                        <label for="muestra">Descripci√≥n de la Muestra:</label>
                        <div class="help-text">Tama√±o, criterios de selecci√≥n, caracter√≠sticas</div>
                        <textarea id="muestra" placeholder="La muestra estar√° conformada por..."></textarea>
                        <button class="btn btn-warning" onclick="solicitarRetroalimentacion('muestra', event)">üîç Obtener Retroalimentaci√≥n
                            <span class="toggle-icon">‚ñº</span></button>
                    </div>
                    <div id="feedback-muestra" class="feedback-box"></div>
                </div>

                <!-- SECCI√ìN 8: T√âCNICAS E INSTRUMENTOS -->
                <div class="section">
                    <div class="section-title">
                        <span class="section-number">8</span>
                        <span>T√©cnicas e Instrumentos de Recolecci√≥n</span>
                    </div>

                    <div class="form-group">
                        <label for="tecnicas">T√©cnicas de Recolecci√≥n:</label>
                        <div class="help-text">Encuesta, entrevista, observaci√≥n, an√°lisis documental, etc.</div>
                        <textarea id="tecnicas" placeholder="Se utilizar√°n las siguientes t√©cnicas..."></textarea>
                        <button class="btn btn-warning" onclick="solicitarRetroalimentacion('tecnicas', event)">üîç Obtener Retroalimentaci√≥n
                            <span class="toggle-icon">‚ñº</span></button>
                    </div>
                    <div id="feedback-tecnicas" class="feedback-box"></div>

                    <div class="form-group">
                        <label for="instrumentos">Instrumentos:</label>
                        <div class="help-text">Cuestionario, gu√≠a de entrevista, ficha de observaci√≥n, etc.</div>
                        <textarea id="instrumentos" placeholder="Los instrumentos a emplear son..."></textarea>
                        <button class="btn btn-warning" onclick="solicitarRetroalimentacion('instrumentos', event)">üîç Obtener Retroalimentaci√≥n
                            <span class="toggle-icon">‚ñº</span></button>
                    </div>
                    <div id="feedback-instrumentos" class="feedback-box"></div>

                    <div class="form-group">
                        <label for="validez">Validez y Confiabilidad:</label>
                        <div class="help-text">¬øC√≥mo garantizar√° la calidad de los datos?</div>
                        <textarea id="validez" placeholder="La validez se garantizar√° mediante..."></textarea>
                        <button class="btn btn-warning" onclick="solicitarRetroalimentacion('validez', event)">üîç Obtener Retroalimentaci√≥n
                            <span class="toggle-icon">‚ñº</span></button>
                    </div>
                    <div id="feedback-validez" class="feedback-box"></div>
                </div>

                <!-- SECCI√ìN 9: PROCEDIMIENTO -->
                <div class="section">
                    <div class="section-title">
                        <span class="section-number">9</span>
                        <span>Procedimiento</span>
                    </div>

                    <div class="form-group">
                        <label for="procedimiento">Fases del Estudio:</label>
                        <div class="help-text">Describa paso a paso c√≥mo realizar√° la investigaci√≥n</div>
                        <textarea id="procedimiento" placeholder="Fase 1: ...
Fase 2: ...
Fase 3: ..."></textarea>
                        <button class="btn btn-warning" onclick="solicitarRetroalimentacion('procedimiento', event)">üîç Obtener Retroalimentaci√≥n
                            <span class="toggle-icon">‚ñº</span></button>
                    </div>
                    <div id="feedback-procedimiento" class="feedback-box"></div>

                    <div class="form-group">
                        <label for="etica">Consideraciones √âticas:</label>
                        <div class="help-text">Consentimiento informado, confidencialidad, etc.</div>
                        <textarea id="etica" placeholder="Se respetar√°n los siguientes principios √©ticos..."></textarea>
                        <button class="btn btn-warning" onclick="solicitarRetroalimentacion('etica', event)">üîç Obtener Retroalimentaci√≥n
                            <span class="toggle-icon">‚ñº</span></button>
                    </div>
                    <div id="feedback-etica" class="feedback-box"></div>
                </div>

                <!-- SECCI√ìN 10: AN√ÅLISIS DE DATOS -->
                <div class="section">
                    <div class="section-title">
                        <span class="section-number">10</span>
                        <span>Plan de An√°lisis de Datos</span>
                    </div>

                    <div class="form-group">
                        <label for="estrategiaAnalisis">Estrategia de An√°lisis:</label>
                        <div class="help-text">¬øC√≥mo analizar√° los datos recolectados?</div>
                        <textarea id="estrategiaAnalisis" placeholder="Los datos ser√°n analizados mediante..."></textarea>
                        <button class="btn btn-warning" onclick="solicitarRetroalimentacion('estrategiaAnalisis', event)">üîç Obtener Retroalimentaci√≥n
                            <span class="toggle-icon">‚ñº</span></button>
                    </div>
                    <div id="feedback-estrategiaAnalisis" class="feedback-box"></div>

                    <div class="form-group">
                        <label for="software">Software de An√°lisis (opcional):</label>
                        <input type="text" id="software" placeholder="SPSS, NVivo, Atlas.ti, R, etc.">
                    </div>

                    <div class="form-group">
                        <label for="interpretacion">Criterios de Interpretaci√≥n:</label>
                        <textarea id="interpretacion" placeholder="Los resultados se interpretar√°n considerando..."></textarea>
                        <button class="btn btn-warning" onclick="solicitarRetroalimentacion('interpretacion', event)">üîç Obtener Retroalimentaci√≥n
                            <span class="toggle-icon">‚ñº</span></button>
                    </div>
                    <div id="feedback-interpretacion" class="feedback-box"></div>
                </div>

                <!-- SECCI√ìN 11: CRONOGRAMA Y RECURSOS -->
                <div class="section">
                    <div class="section-title">
                        <span class="section-number">11</span>
                        <span>Cronograma y Recursos</span>
                    </div>

                    <div class="form-group">
                        <label for="cronograma">Cronograma de Actividades:</label>
                        <textarea id="cronograma" placeholder="Mes 1-2: Revisi√≥n de literatura
Mes 3-4: Dise√±o de instrumentos
Mes 5-6: Recolecci√≥n de datos
..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="recursos">Recursos Necesarios:</label>
                        <textarea id="recursos" placeholder="Recursos humanos:
Recursos materiales:
Recursos financieros:"></textarea>
                    </div>
                </div>

                <!-- SECCI√ìN 12: REFERENCIAS -->
                <div class="section">
                    <div class="section-title">
                        <span class="section-number">12</span>
                        <span>Referencias Bibliogr√°ficas</span>
                    </div>

                    <div class="form-group">
                        <label for="referencias">Referencias (Formato APA 7¬™ edici√≥n):</label>
                        <div class="help-text">Una referencia por l√≠nea</div>
                        <textarea id="referencias" placeholder="Apellido, A. A. (A√±o). T√≠tulo del libro. Editorial."></textarea>
                    </div>
                </div>

                <!-- BOTONES DE ACCI√ìN -->
                <div class="action-buttons">
                    <button class="btn btn-success" onclick="generarProtocolo()">üìÑ Generar Protocolo Completo</button>
                    <button class="btn" onclick="guardarProgreso()">üíæ Guardar Progreso</button>
                    <button class="btn btn-secondary" onclick="limpiarFormulario()">üóëÔ∏è Limpiar Todo</button>
                </div>
            </div>
        </div>

        <!-- VISTA PREVIA DEL DOCUMENTO -->
        <div id="vistaPrevia" class="hidden">
            <div class="action-buttons" style="padding: 20px; background: #f5f5f5;">
                <button class="btn btn-success" onclick="exportarPDF()">üì• Exportar a PDF</button>
                <button class="btn btn-secondary" onclick="volverFormulario()">‚úèÔ∏è Volver a Editar</button>
            </div>
        </div>

        <div id="documentoFinal" class="hidden">
            <div id="contenidoProtocolo"></div>
        </div>
    </div>

    <script>
        // ============================================
        // SISTEMA DE AUTENTICACI√ìN Y GESTI√ìN DE USUARIOS
        // ============================================
        
        // Base de datos de usuarios (en producci√≥n, esto estar√≠a en un servidor)
        const USERS_DATABASE = {
            'oscar': {
                password: 'unicla2025',
                fullName: 'Oscar (Investigador Principal)',
                role: 'investigador'
            },
            'profesor': {
                password: 'profesor123',
                fullName: 'Profesor UNICLA',
                role: 'profesor'
            },
            'estudiante': {
                password: 'estudiante123',
                fullName: 'Estudiante UNICLA',
                role: 'estudiante'
            }
        };

        // Usuario actual en sesi√≥n
        let currentUser = null;

        // Verificar si hay sesi√≥n activa al cargar la p√°gina
        function checkSession() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = savedUser;
                showMainApp();
            }
        }

        // Funci√≥n de login
        function login(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('loginError');
            
            // Validar credenciales
            if (USERS_DATABASE[username] && USERS_DATABASE[username].password === password) {
                // Login exitoso
                currentUser = username;
                localStorage.setItem('currentUser', username);
                
                // Ocultar error si estaba visible
                errorDiv.classList.remove('show');
                
                // Mostrar aplicaci√≥n principal
                showMainApp();
                
                // Limpiar formulario
                document.getElementById('loginForm').reset();
            } else {
                // Login fallido
                errorDiv.classList.add('show');
                
                // Ocultar error despu√©s de 3 segundos
                setTimeout(() => {
                    errorDiv.classList.remove('show');
                }, 3000);
            }
        }

        // Mostrar aplicaci√≥n principal
        function showMainApp() {
            // Ocultar pantalla de login
            document.getElementById('loginScreen').classList.add('hidden');
            
            // Mostrar contenedor principal
            document.getElementById('mainContainer').classList.remove('hidden');
            
            // Mostrar nombre de usuario
            const userInfo = USERS_DATABASE[currentUser];
            document.getElementById('displayUsername').textContent = userInfo.fullName;
            
            // Cargar datos del usuario
            cargarProgreso();
        }

        // Funci√≥n de logout
        function logout() {
            if (confirm('¬øEst√° seguro de que desea cerrar sesi√≥n? Aseg√∫rese de haber guardado su progreso.')) {
                // Limpiar sesi√≥n
                localStorage.removeItem('currentUser');
                currentUser = null;
                
                // Ocultar aplicaci√≥n principal
                document.getElementById('mainContainer').classList.add('hidden');
                
                // Mostrar pantalla de login
                document.getElementById('loginScreen').classList.remove('hidden');
                
                // Limpiar formulario de login
                document.getElementById('loginForm').reset();
            }
        }

        // Obtener clave de almacenamiento espec√≠fica del usuario
        function getUserStorageKey() {
            return `protocoloInvestigacionUNICLA_${currentUser}`;
        }

        // ============================================
        // RESTO DE FUNCIONES DE LA APLICACI√ìN
        // ============================================

        // Actualizar barra de progreso
        function actualizarProgreso() {
            const campos = document.querySelectorAll('input[type="text"], textarea, select');
            let completados = 0;
            campos.forEach(campo => {
                if (campo.value.trim() !== '') completados++;
            });
            const porcentaje = Math.round((completados / campos.length) * 100);
            document.getElementById('progressFill').style.width = porcentaje + '%';
            document.getElementById('progressFill').textContent = porcentaje + '%';
        }

        // Escuchar cambios en los campos
        document.querySelectorAll('input, textarea, select').forEach(campo => {
            campo.addEventListener('input', actualizarProgreso);
        });

        // Mostrar informaci√≥n del enfoque
        function mostrarEnfoque() {
            const enfoqueSeleccionado = document.querySelector('input[name="enfoque"]:checked');
            const infoBox = document.getElementById('infoEnfoque');
            const descripcion = document.getElementById('descripcionEnfoque');
            const seccionHipotesis = document.getElementById('seccionHipotesis');

            if (enfoqueSeleccionado) {
                infoBox.classList.remove('hidden');
                const enfoque = enfoqueSeleccionado.value;

                if (enfoque === 'cuantitativo') {
                    descripcion.innerHTML = `
                        <strong>Enfoque Cuantitativo:</strong> Proceso secuencial y probatorio que utiliza la recolecci√≥n 
                        de datos para probar hip√≥tesis mediante medici√≥n num√©rica y an√°lisis estad√≠stico. 
                        Se busca establecer patrones de comportamiento y probar teor√≠as (Hern√°ndez-Sampieri et al., 2014).
                    `;
                    seccionHipotesis.style.display = 'block';
                } else if (enfoque === 'cualitativo') {
                    descripcion.innerHTML = `
                        <strong>Enfoque Cualitativo:</strong> Proceso inductivo y recurrente que se conduce en ambientes naturales.
                        Los significados se extraen de los datos sin fundamentarse en la estad√≠stica. 
                        Busca la dispersi√≥n o expansi√≥n de datos e informaci√≥n (Hern√°ndez-Sampieri et al., 2014).
                    `;
                    seccionHipotesis.style.display = 'none';
                } else if (enfoque === 'mixto') {
                    descripcion.innerHTML = `
                        <strong>Enfoque Mixto:</strong> Combina los enfoques cuantitativo y cualitativo, implica la recolecci√≥n 
                        y an√°lisis de datos de ambos tipos. Permite lograr una perspectiva m√°s amplia y profunda del fen√≥meno, 
                        triangulaci√≥n y complementaci√≥n (Hern√°ndez-Sampieri et al., 2014).
                    `;
                    seccionHipotesis.style.display = 'block';
                }
                actualizarProgreso();
            }
        }

        // Funci√≥n para solicitar retroalimentaci√≥n interdisciplinaria (con comportamiento retr√°ctil)
        function solicitarRetroalimentacion(campo, event) {
            const valor = document.getElementById(campo).value;
            const feedbackDiv = document.getElementById('feedback-' + campo);
            const button = event ? event.currentTarget : document.querySelector(`button[onclick*="'${campo}'"]`);
            
            // Si el feedback ya est√° visible, ocultarlo (comportamiento retr√°ctil)
            if (feedbackDiv.classList.contains('show')) {
                feedbackDiv.classList.remove('show');
                if (button) {
                    button.classList.remove('active');
                }
                return;
            }
            
            // Validar que el campo tenga contenido
            if (!valor || valor.trim() === '') {
                alert('‚ö†Ô∏è Por favor, complete el campo antes de solicitar retroalimentaci√≥n.');
                return;
            }

            // Obtener el enfoque metodol√≥gico si est√° disponible
            const enfoqueElement = document.querySelector('input[name="enfoque"]:checked');
            const enfoque = enfoqueElement ? enfoqueElement.value : 'no especificado';

            // Generar retroalimentaci√≥n basada en el campo (solo si no existe ya)
            if (!feedbackDiv.innerHTML || feedbackDiv.innerHTML.trim() === '') {
                const retroalimentacion = generarRetroalimentacionInterdisciplinaria(campo, valor, enfoque);
                feedbackDiv.innerHTML = retroalimentacion;
            }
            
            // Mostrar el feedback
            feedbackDiv.classList.add('show');
            if (button) {
                button.classList.add('active');
            }
            
            // Scroll suave hacia la retroalimentaci√≥n
            setTimeout(() => {
                feedbackDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
        }

        // Funci√≥n que genera retroalimentaci√≥n interdisciplinaria
        function generarRetroalimentacionInterdisciplinaria(campo, valor, enfoque) {
            const retroalimentaciones = {
                'titulo': {
                    'metodologia': `El t√≠tulo debe ser claro, conciso y comunicar de manera precisa el contenido de la investigaci√≥n. Seg√∫n Hern√°ndez-Sampieri et al. (2014), un buen t√≠tulo debe reflejar el problema, las variables principales y el contexto del estudio. Se recomienda que no exceda 15-20 palabras.`,
                    'sociologia': `Desde la perspectiva sociol√≥gica, el t√≠tulo debe evidenciar la relevancia social del fen√≥meno estudiado y su contextualizaci√≥n hist√≥rica y cultural. Los t√≠tulos efectivos anticipan la contribuci√≥n al conocimiento sobre estructuras y procesos sociales (Mills, 1959).`,
                    'psicologia': `La psicolog√≠a enfatiza que el t√≠tulo debe reflejar claramente los constructos psicol√≥gicos investigados y sus relaciones te√≥ricas. Es fundamental que comunique el nivel de an√°lisis (individual, grupal, organizacional) y el tipo de procesos mentales o conductuales estudiados.`,
                    'linguistica': `Desde la ling√º√≠stica, el t√≠tulo debe presentar una estructura gramatical clara, evitando ambig√ºedades sem√°nticas. La precisi√≥n l√©xica y la coherencia sint√°ctica son esenciales para la correcta interpretaci√≥n del alcance investigativo.`,
                    'referencia': `Hern√°ndez-Sampieri, R., Fern√°ndez, C., & Baptista, P. (2014). <em>Metodolog√≠a de la investigaci√≥n</em> (6¬™ ed.). McGraw-Hill Education.`
                },
                'antecedentes': {
                    'metodologia': `Los antecedentes deben presentar una revisi√≥n cronol√≥gica y tem√°tica de estudios previos, identificando hallazgos clave, vac√≠os de conocimiento y la evoluci√≥n del problema de investigaci√≥n. Esta secci√≥n justifica la necesidad del estudio actual (Hern√°ndez-Sampieri et al., 2014).`,
                    'historia': `La perspectiva hist√≥rica requiere contextualizar el problema en su dimensi√≥n temporal, identificando coyunturas cr√≠ticas, procesos de cambio y continuidades que permiten comprender la genealog√≠a del fen√≥meno estudiado.`,
                    'filosofia': `Filos√≥ficamente, los antecedentes deben revelar los presupuestos epistemol√≥gicos y ontol√≥gicos que han guiado investigaciones previas, as√≠ como las controversias conceptuales y debates paradigm√°ticos que enmarcan el problema.`,
                    'antropologia': `Desde la antropolog√≠a, es crucial considerar c√≥mo diferentes contextos culturales han abordado fen√≥menos similares, reconociendo la diversidad de perspectivas y pr√°cticas que informan el problema de investigaci√≥n.`,
                    'referencia': `Hern√°ndez-Sampieri, R., Fern√°ndez, C., & Baptista, P. (2014). <em>Metodolog√≠a de la investigaci√≥n</em> (6¬™ ed.). McGraw-Hill Education.`
                },
                'descripcionProblema': {
                    'metodologia': `La descripci√≥n del problema debe articular claramente la situaci√≥n problem√°tica, sus manifestaciones observables, magnitud, relevancia y consecuencias. Debe responder: ¬øQu√© sucede? ¬øD√≥nde? ¬øCu√°ndo? ¬øQui√©nes est√°n involucrados? (Hern√°ndez-Sampieri et al., 2014).`,
                    'sociologia': `Sociol√≥gicamente, el problema debe analizarse en su dimensi√≥n estructural, identificando las relaciones de poder, inequidades y din√°micas institucionales que lo configuran. Es esencial vincular el problema con procesos sociales m√°s amplios.`,
                    'economia': `La econom√≠a requiere cuantificar el problema en t√©rminos de costos, recursos afectados, ineficiencias y oportunidades perdidas. La descripci√≥n debe evidenciar el impacto econ√≥mico y las implicaciones para la asignaci√≥n de recursos.`,
                    'comunicacion': `Desde las ciencias de la comunicaci√≥n, es importante analizar c√≥mo se construye discursivamente el problema, qu√© actores lo definen, qu√© narrativas prevalecen y qu√© voces son silenciadas en su representaci√≥n.`,
                    'referencia': `Hern√°ndez-Sampieri, R., Fern√°ndez, C., & Baptista, P. (2014). <em>Metodolog√≠a de la investigaci√≥n</em> (6¬™ ed.). McGraw-Hill Education.`
                },
                'preguntaPrincipal': {
                    'metodologia': `La pregunta de investigaci√≥n debe ser clara, precisa y factible de responder. Seg√∫n Hern√°ndez-Sampieri et al. (2014), debe reflejar el problema, ser congruente con los objetivos y orientar el tipo de estudio. Debe evitar ambig√ºedades y ser relevante para el campo disciplinar.`,
                    'epistemologia': `Epistemol√≥gicamente, la pregunta debe revelar qu√© tipo de conocimiento se busca producir y desde qu√© posicionamiento te√≥rico. Una buena pregunta delimita el objeto de conocimiento y anticipa el tipo de respuesta epistemol√≥gicamente v√°lida.`,
                    'logica': `Desde la l√≥gica, la pregunta debe estar bien formulada, evitando falacias, presuposiciones infundadas y estructura circular. Debe permitir respuestas contrastables y evidenciar las relaciones l√≥gicas entre variables o fen√≥menos.`,
                    'retorica': `Ret√≥ricamente, la pregunta debe ser persuasiva respecto a su importancia investigativa, captar el inter√©s acad√©mico y demostrar su capacidad para generar conocimiento significativo y transferible.`,
                    'referencia': `Hern√°ndez-Sampieri, R., Fern√°ndez, C., & Baptista, P. (2014). <em>Metodolog√≠a de la investigaci√≥n</em> (6¬™ ed.). McGraw-Hill Education.`
                },
                'objetivoGeneral': {
                    'metodologia': `El objetivo general debe iniciar con un verbo en infinitivo que indique la acci√≥n investigativa principal (analizar, evaluar, determinar, etc.). Debe ser congruente con la pregunta de investigaci√≥n y alcanzable dentro del tiempo y recursos disponibles (Hern√°ndez-Sampieri et al., 2014).`,
                    'planificacion': `Desde la gesti√≥n de proyectos, el objetivo debe cumplir criterios SMART: Espec√≠fico, Medible, Alcanzable, Relevante y Temporal. Debe funcionar como referente para evaluar el √©xito del proyecto investigativo.`,
                    'pedagogia': `Pedag√≥gicamente, el objetivo debe formularse considerando taxonom√≠as del aprendizaje y niveles cognitivos (Bloom). La claridad del objetivo facilita tanto la ejecuci√≥n como la evaluaci√≥n de los resultados de investigaci√≥n.`,
                    'administracion': `La perspectiva administrativa enfatiza que el objetivo debe alinearse con metas estrat√©gicas, permitir la asignaci√≥n eficiente de recursos y facilitar el monitoreo del avance investigativo mediante indicadores verificables.`,
                    'referencia': `Hern√°ndez-Sampieri, R., Fern√°ndez, C., & Baptista, P. (2014). <em>Metodolog√≠a de la investigaci√≥n</em> (6¬™ ed.). McGraw-Hill Education.`
                },
                'relevanciaTeorica': {
                    'metodologia': `La relevancia te√≥rica debe explicitar c√≥mo la investigaci√≥n contribuye al desarrollo de teor√≠as, conceptos o modelos explicativos. Debe identificar el vac√≠o te√≥rico que se pretende llenar o la controversia que se busca resolver (Hern√°ndez-Sampieri et al., 2014).`,
                    'epistemologia': `Epistemol√≥gicamente, debe quedar claro qu√© tipo de conocimiento se producir√° y c√≥mo se relaciona con los debates te√≥ricos actuales. La relevancia te√≥rica implica avanzar en la comprensi√≥n conceptual del fen√≥meno.`,
                    'filosofia_ciencia': `Desde la filosof√≠a de la ciencia, la relevancia te√≥rica se vincula con el progreso cient√≠fico: ¬øLa investigaci√≥n refuta, confirma o refina teor√≠as existentes? ¬øPropone nuevos marcos explicativos o integra perspectivas previamente desconectadas?`,
                    'sociologia_conocimiento': `La sociolog√≠a del conocimiento enfatiza que la relevancia te√≥rica tambi√©n debe considerar para qu√© comunidades acad√©micas y en qu√© contextos socioculturales el conocimiento producido ser√° significativo y transformador.`,
                    'referencia': `Hern√°ndez-Sampieri, R., Fern√°ndez, C., & Baptista, P. (2014). <em>Metodolog√≠a de la investigaci√≥n</em> (6¬™ ed.). McGraw-Hill Education.`
                },
                'enfoque': {
                    'metodologia': `La elecci√≥n del enfoque debe fundamentarse en la naturaleza del problema, los objetivos y las preguntas de investigaci√≥n. Hern√°ndez-Sampieri et al. (2014) se√±alan que el enfoque cuantitativo busca generalizaci√≥n mediante an√°lisis estad√≠stico; el cualitativo, profundidad y comprensi√≥n contextual; y el mixto, complementariedad y triangulaci√≥n.`,
                    'pragmatismo': `Desde el pragmatismo filos√≥fico, la elecci√≥n metodol√≥gica debe guiarse por el criterio de utilidad: ¬øQu√© enfoque permite responder mejor las preguntas planteadas? No hay enfoques inherentemente superiores, sino apropiados para contextos espec√≠ficos.`,
                    'paradigmas': `La teor√≠a de paradigmas investigativos (Kuhn) sugiere que los enfoques responden a cosmovisiones diferentes sobre la naturaleza de la realidad (ontolog√≠a) y las formas v√°lidas de conocerla (epistemolog√≠a). La elecci√≥n implica posicionamiento paradigm√°tico.`,
                    'complejidad': `La teor√≠a de la complejidad propone que fen√≥menos multidimensionales requieren enfoques mixtos que capturen tanto patrones generales (cuantitativo) como particularidades contextuales (cualitativo), reconociendo la irreductibilidad de lo social.`,
                    'referencia': `Hern√°ndez-Sampieri, R., Fern√°ndez, C., & Baptista, P. (2014). <em>Metodolog√≠a de la investigaci√≥n</em> (6¬™ ed.). McGraw-Hill Education.`
                },
                'poblacion': {
                    'metodologia': `La poblaci√≥n debe definirse claramente especificando caracter√≠sticas, tama√±o y delimitaci√≥n espaciotemporal. Debe permitir identificar inequ√≠vocamente qui√©nes pueden ser sujetos del estudio (Hern√°ndez-Sampieri et al., 2014).`,
                    'demografia': `Demogr√°ficamente, es esencial caracterizar la poblaci√≥n seg√∫n variables relevantes: edad, sexo, ubicaci√≥n geogr√°fica, nivel socioecon√≥mico, etc. Esta caracterizaci√≥n orienta el dise√±o muestral y la generalizaci√≥n de resultados.`,
                    'estadistica': `La estad√≠stica requiere precisi√≥n en la definici√≥n del marco muestral y el tama√±o poblacional para calcular muestras representativas. La claridad en la definici√≥n poblacional determina la validez externa del estudio.`,
                    'etica': `√âticamente, la definici√≥n poblacional debe considerar criterios de inclusi√≥n/exclusi√≥n que no discriminen arbitrariamente y que protejan a poblaciones vulnerables, asegurando que la investigaci√≥n respete principios de justicia y beneficencia.`,
                    'referencia': `Hern√°ndez-Sampieri, R., Fern√°ndez, C., & Baptista, P. (2014). <em>Metodolog√≠a de la investigaci√≥n</em> (6¬™ ed.). McGraw-Hill Education.`
                },
                'tecnicas': {
                    'metodologia': `Las t√©cnicas de recolecci√≥n deben ser congruentes con el enfoque, los objetivos y la naturaleza de las variables estudiadas. Hern√°ndez-Sampieri et al. (2014) clasifican t√©cnicas cuantitativas (encuestas, experimentos) y cualitativas (entrevistas, observaci√≥n participante, grupos focales).`,
                    'psicometria': `La psicometr√≠a enfatiza que las t√©cnicas de medici√≥n deben cumplir requisitos de validez (medir lo que pretenden medir) y confiabilidad (producir resultados consistentes). La elecci√≥n t√©cnica debe justificarse psicom√©tricamente.`,
                    'etnografia': `Desde la etnograf√≠a, las t√©cnicas deben permitir acceder a la perspectiva emic (del participante) y captar la complejidad cultural del fen√≥meno. La inmersi√≥n prolongada y la triangulaci√≥n de t√©cnicas son principios fundamentales.`,
                    'hermeneutica': `Hermen√©uticamente, las t√©cnicas deben facilitar la comprensi√≥n interpretativa de significados, considerando el c√≠rculo hermen√©utico: la relaci√≥n dial√©ctica entre parte y todo, texto y contexto, en la construcci√≥n de sentido.`,
                    'referencia': `Hern√°ndez-Sampieri, R., Fern√°ndez, C., & Baptista, P. (2014). <em>Metodolog√≠a de la investigaci√≥n</em> (6¬™ ed.). McGraw-Hill Education.`
                }
            };

            // Obtener retroalimentaci√≥n espec√≠fica o usar una gen√©rica
            const retroCampo = retroalimentaciones[campo] || {
                'metodologia': 'Considere los principios metodol√≥gicos de rigor, sistematicidad y coherencia interna del protocolo.',
                'general': 'Aseg√∫rese de que este componente est√© alineado con los objetivos y el enfoque metodol√≥gico de su investigaci√≥n.',
                'referencia': 'Hern√°ndez-Sampieri, R., Fern√°ndez, C., & Baptista, P. (2014). <em>Metodolog√≠a de la investigaci√≥n</em> (6¬™ ed.). McGraw-Hill Education.'
            };

            let html = `
                <div class="feedback-title">
                    <span class="feedback-icon">‚ú®</span>
                    Retroalimentaci√≥n Interdisciplinaria
                </div>
                
                <div class="interdisciplinary-analysis">
                    <div class="interdisciplinary-title">An√°lisis desde M√∫ltiples Perspectivas Disciplinarias</div>
            `;

            // Agregar perspectivas disciplinarias
            for (const [disciplina, contenido] of Object.entries(retroCampo)) {
                if (disciplina !== 'referencia') {
                    const nombreDisciplina = disciplina.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                    html += `
                        <div class="perspective">
                            <div class="perspective-title">
                                <span class="discipline-badge">${nombreDisciplina}</span>
                            </div>
                            <div class="perspective-content">
                                ${contenido}
                            </div>
                        </div>
                    `;
                }
            }

            // Agregar metodolog√≠a de Hern√°ndez-Sampieri
            html += `
                <div class="methodology-section">
                    <div class="methodology-title">üìö Seg√∫n Hern√°ndez-Sampieri et al. (2014)</div>
                    <p>La metodolog√≠a contempor√°nea indica que las t√©cnicas y componentes del protocolo deben adaptarse 
                    al planteamiento del problema y no al rev√©s. El enfoque <strong>${enfoque}</strong> que ha seleccionado 
                    debe permear consistentemente todos los componentes de su protocolo de investigaci√≥n, asegurando 
                    coherencia epistemol√≥gica y metodol√≥gica.</p>
                </div>
            `;

            // Agregar referencia bibliogr√°fica
            html += `
                <div class="reference">
                    <strong>Referencia:</strong><br>
                    ${retroCampo.referencia}
                </div>
            `;

            html += `</div>`;

            return html;
        }

        // Generar protocolo completo
        function generarProtocolo() {
            // Validar campos m√≠nimos
            const camposRequeridos = ['titulo', 'descripcionProblema', 'preguntaPrincipal', 'objetivoGeneral'];
            let faltantes = [];
            
            camposRequeridos.forEach(campo => {
                if (!document.getElementById(campo).value.trim()) {
                    faltantes.push(campo);
                }
            });

            if (faltantes.length > 0) {
                alert('‚ö†Ô∏è Por favor complete los campos obligatorios: ' + faltantes.join(', '));
                return;
            }

            // Recopilar todos los datos
            const datos = {
                // Datos institucionales
                institucion: document.getElementById('institucion').value,
                facultad: document.getElementById('facultad').value,
                programa: document.getElementById('programa').value,
                autor: document.getElementById('autor').value,
                director: document.getElementById('director').value,
                linea: document.getElementById('linea').value,
                ciudad: document.getElementById('ciudad').value,
                estado: document.getElementById('estado').value,
                fecha: document.getElementById('fecha').value,
                
                // Datos del protocolo
                titulo: document.getElementById('titulo').value,
                antecedentes: document.getElementById('antecedentes').value,
                descripcionProblema: document.getElementById('descripcionProblema').value,
                preguntaPrincipal: document.getElementById('preguntaPrincipal').value,
                preguntasEspecificas: document.getElementById('preguntasEspecificas').value,
                objetivoGeneral: document.getElementById('objetivoGeneral').value,
                objetivosEspecificos: document.getElementById('objetivosEspecificos').value,
                relevanciaTeorica: document.getElementById('relevanciaTeorica').value,
                relevanciaPractica: document.getElementById('relevanciaPractica').value,
                relevanciaMetodologica: document.getElementById('relevanciaMetodologica').value,
                viabilidad: document.getElementById('viabilidad').value,
                teorias: document.getElementById('teorias').value,
                literatura: document.getElementById('literatura').value,
                conceptos: document.getElementById('conceptos').value,
                enfoque: document.querySelector('input[name="enfoque"]:checked')?.value || '',
                alcance: document.getElementById('alcance').value,
                diseno: document.getElementById('diseno').value,
                hipotesisInvestigacion: document.getElementById('hipotesisInvestigacion').value,
                hipotesisNula: document.getElementById('hipotesisNula').value,
                hipotesisAlternativa: document.getElementById('hipotesisAlternativa').value,
                variables: document.getElementById('variables').value,
                poblacion: document.getElementById('poblacion').value,
                tipoMuestreo: document.getElementById('tipoMuestreo').value,
                muestra: document.getElementById('muestra').value,
                tecnicas: document.getElementById('tecnicas').value,
                instrumentos: document.getElementById('instrumentos').value,
                validez: document.getElementById('validez').value,
                procedimiento: document.getElementById('procedimiento').value,
                etica: document.getElementById('etica').value,
                estrategiaAnalisis: document.getElementById('estrategiaAnalisis').value,
                software: document.getElementById('software').value,
                interpretacion: document.getElementById('interpretacion').value,
                cronograma: document.getElementById('cronograma').value,
                recursos: document.getElementById('recursos').value,
                referencias: document.getElementById('referencias').value
            };

            // Generar la portada
            let portada = `
                <div class="portada">
                    <div class="portada-header">
                        <img src="logo_unicla.png" alt="UNICLA Logo">
                        <h2>${datos.institucion || 'Universidad Contempor√°nea de las Am√©ricas'}</h2>
                        ${datos.facultad ? `<p>${datos.facultad}</p>` : ''}
                        ${datos.programa ? `<p>${datos.programa}</p>` : ''}
                    </div>
                    
                    <div class="portada-content">
                        <p class="portada-subtitulo">PROTOCOLO DE INVESTIGACI√ìN</p>
                        <h1 class="portada-titulo">${datos.titulo || 'T√çTULO DE LA INVESTIGACI√ìN'}</h1>
                        
                        ${datos.autor ? `<div class="portada-datos">
                            <p class="label">Presentado por:</p>
                            <p>${datos.autor}</p>
                        </div>` : ''}
                        
                        ${datos.director ? `<div class="portada-datos">
                            <p class="label">Director de Tesis:</p>
                            <p>${datos.director}</p>
                        </div>` : ''}
                        
                        ${datos.linea ? `<div class="portada-datos-institucionales">
                            <p><strong>L√≠nea de Investigaci√≥n:</strong> ${datos.linea}</p>
                        </div>` : ''}
                    </div>
                    
                    <div class="portada-pie">
                        <p>${datos.ciudad || 'Ciudad'}, ${datos.estado || 'Estado, Pa√≠s'}</p>
                        <p class="fecha">${datos.fecha || 'Mes y A√±o'}</p>
                    </div>
                </div>
            `;

            // Generar el contenido del protocolo
            let protocolo = `
                <div class="protocolo-content">
                    <h1>${datos.titulo || 'T√çTULO DE LA INVESTIGACI√ìN'}</h1>

                    <h2>1. PLANTEAMIENTO DEL PROBLEMA</h2>
                    
                    <h3>1.1. Antecedentes</h3>
                    <p>${datos.antecedentes || '[Completar antecedentes]'}</p>

                    <h3>1.2. Descripci√≥n del Problema</h3>
                    <p>${datos.descripcionProblema || '[Completar descripci√≥n del problema]'}</p>

                    <h3>1.3. Pregunta de Investigaci√≥n</h3>
                    <p><strong>Principal:</strong> ${datos.preguntaPrincipal || '[Completar pregunta principal]'}</p>
                    ${datos.preguntasEspecificas ? `<p><strong>Espec√≠ficas:</strong><br>${datos.preguntasEspecificas.replace(/\n/g, '<br>')}</p>` : ''}

                    <h2>2. OBJETIVOS</h2>
                    
                    <h3>2.1. Objetivo General</h3>
                    <p>${datos.objetivoGeneral || '[Completar objetivo general]'}</p>

                    <h3>2.2. Objetivos Espec√≠ficos</h3>
                    <p>${datos.objetivosEspecificos ? datos.objetivosEspecificos.replace(/\n/g, '<br>') : '[Completar objetivos espec√≠ficos]'}</p>

                    <h2>3. JUSTIFICACI√ìN</h2>
                    
                    <h3>3.1. Relevancia Te√≥rica</h3>
                    <p>${datos.relevanciaTeorica || '[Completar relevancia te√≥rica]'}</p>

                    <h3>3.2. Relevancia Pr√°ctica y Social</h3>
                    <p>${datos.relevanciaPractica || '[Completar relevancia pr√°ctica]'}</p>

                    ${datos.relevanciaMetodologica ? `<h3>3.3. Relevancia Metodol√≥gica</h3>
                    <p>${datos.relevanciaMetodologica}</p>` : ''}

                    <h3>3.4. Viabilidad</h3>
                    <p>${datos.viabilidad || '[Completar viabilidad]'}</p>

                    <h2>4. MARCO TE√ìRICO Y CONCEPTUAL</h2>
                    
                    <h3>4.1. Teor√≠as y Enfoques</h3>
                    <p>${datos.teorias || '[Completar teor√≠as y enfoques]'}</p>

                    <h3>4.2. Revisi√≥n de Literatura</h3>
                    <p>${datos.literatura || '[Completar revisi√≥n de literatura]'}</p>

                    <h3>4.3. Conceptos Clave</h3>
                    <p>${datos.conceptos ? datos.conceptos.replace(/\n/g, '<br>') : '[Completar conceptos clave]'}</p>

                    <h2>5. METODOLOG√çA</h2>
                    
                    <h3>5.1. Enfoque Metodol√≥gico</h3>
                    <p>${datos.enfoque ? datos.enfoque.charAt(0).toUpperCase() + datos.enfoque.slice(1) : '[Seleccionar enfoque]'}</p>

                    <h3>5.2. Alcance del Estudio</h3>
                    <p>${datos.alcance || '[Especificar alcance]'}</p>

                    <h3>5.3. Dise√±o de Investigaci√≥n</h3>
                    <p>${datos.diseno || '[Completar dise√±o de investigaci√≥n]'}</p>
            `;

            if (datos.enfoque === 'cuantitativo' || datos.enfoque === 'mixto') {
                protocolo += `
                    <h2>6. HIP√ìTESIS Y VARIABLES</h2>
                    
                    ${datos.hipotesisInvestigacion ? `<h3>6.1. Hip√≥tesis de Investigaci√≥n</h3>
                    <p>${datos.hipotesisInvestigacion}</p>` : ''}

                    ${datos.hipotesisNula ? `<h3>6.2. Hip√≥tesis Nula</h3>
                    <p>${datos.hipotesisNula}</p>` : ''}

                    ${datos.hipotesisAlternativa ? `<h3>6.3. Hip√≥tesis Alternativa</h3>
                    <p>${datos.hipotesisAlternativa}</p>` : ''}

                    <h3>6.4. Variables</h3>
                    <p>${datos.variables ? datos.variables.replace(/\n/g, '<br>') : '[Completar variables]'}</p>
                `;
            }

            protocolo += `
                    <h2>7. POBLACI√ìN Y MUESTRA</h2>
                    
                    <h3>7.1. Poblaci√≥n</h3>
                    <p>${datos.poblacion || '[Completar poblaci√≥n]'}</p>

                    <h3>7.2. Tipo de Muestreo</h3>
                    <p>${datos.tipoMuestreo || '[Especificar tipo de muestreo]'}</p>

                    <h3>7.3. Muestra</h3>
                    <p>${datos.muestra || '[Completar caracter√≠sticas de la muestra]'}</p>

                    <h2>8. T√âCNICAS E INSTRUMENTOS</h2>
                    
                    <h3>8.1. T√©cnicas de Recolecci√≥n</h3>
                    <p>${datos.tecnicas || '[Completar t√©cnicas]'}</p>

                    <h3>8.2. Instrumentos</h3>
                    <p>${datos.instrumentos || '[Completar instrumentos]'}</p>

                    <h3>8.3. Validez y Confiabilidad</h3>
                    <p>${datos.validez || '[Completar validez y confiabilidad]'}</p>

                    <h2>9. PROCEDIMIENTO</h2>
                    
                    <h3>9.1. Fases del Estudio</h3>
                    <p>${datos.procedimiento ? datos.procedimiento.replace(/\n/g, '<br>') : '[Completar procedimiento]'}</p>

                    <h3>9.2. Consideraciones √âticas</h3>
                    <p>${datos.etica || '[Completar consideraciones √©ticas]'}</p>

                    <h2>10. PLAN DE AN√ÅLISIS DE DATOS</h2>
                    
                    <h3>10.1. Estrategia de An√°lisis</h3>
                    <p>${datos.estrategiaAnalisis || '[Completar estrategia de an√°lisis]'}</p>

                    ${datos.software ? `<h3>10.2. Software</h3>
                    <p>${datos.software}</p>` : ''}

                    <h3>10.3. Criterios de Interpretaci√≥n</h3>
                    <p>${datos.interpretacion || '[Completar criterios de interpretaci√≥n]'}</p>

                    <h2>11. CRONOGRAMA Y RECURSOS</h2>
                    
                    <h3>11.1. Cronograma</h3>
                    <p>${datos.cronograma ? datos.cronograma.replace(/\n/g, '<br>') : '[Completar cronograma]'}</p>

                    <h3>11.2. Recursos</h3>
                    <p>${datos.recursos ? datos.recursos.replace(/\n/g, '<br>') : '[Completar recursos]'}</p>

                    <h2>12. REFERENCIAS</h2>
                    <p>${datos.referencias ? datos.referencias.replace(/\n/g, '<br><br>') : '[Completar referencias en formato APA 7¬™ edici√≥n]'}</p>
                </div>
            `;

            // Insertar en documento final
            document.getElementById('contenidoProtocolo').innerHTML = portada + protocolo;
            
            // Ocultar formulario y mostrar vista previa
            document.querySelector('.form-area').style.display = 'none';
            document.getElementById('documentoFinal').classList.remove('hidden');
            document.getElementById('vistaPrevia').classList.remove('hidden');
            
            // Scroll al inicio
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Exportar a PDF
        function exportarPDF() {
            window.print();
        }

        // Volver al formulario
        function volverFormulario() {
            document.querySelector('.form-area').style.display = 'block';
            document.getElementById('documentoFinal').classList.add('hidden');
            document.getElementById('vistaPrevia').classList.add('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Guardar progreso en localStorage (espec√≠fico por usuario)
        function guardarProgreso() {
            const campos = document.querySelectorAll('input[type="text"], textarea, select');
            const datos = {};
            campos.forEach(campo => {
                datos[campo.id] = campo.value;
            });
            
            const enfoque = document.querySelector('input[name="enfoque"]:checked');
            if (enfoque) datos['enfoque'] = enfoque.value;
            
            // Guardar con clave espec√≠fica del usuario
            localStorage.setItem(getUserStorageKey(), JSON.stringify(datos));
            alert('‚úÖ Progreso guardado exitosamente para el usuario: ' + USERS_DATABASE[currentUser].fullName);
        }

        // Cargar progreso guardado (espec√≠fico por usuario)
        function cargarProgreso() {
            if (!currentUser) return; // No cargar si no hay usuario logueado
            
            const datos = JSON.parse(localStorage.getItem(getUserStorageKey()));
            if (datos) {
                Object.keys(datos).forEach(key => {
                    if (key === 'enfoque') {
                        const radio = document.getElementById(datos[key]);
                        if (radio) {
                            radio.checked = true;
                            mostrarEnfoque();
                        }
                    } else {
                        const campo = document.getElementById(key);
                        if (campo) campo.value = datos[key];
                    }
                });
                actualizarProgreso();
            }
        }

        // Limpiar formulario
        function limpiarFormulario() {
            if (confirm('¬øEst√°s seguro de que deseas limpiar todos los campos?')) {
                document.querySelectorAll('input[type="text"], textarea, select').forEach(campo => {
                    campo.value = '';
                });
                document.querySelectorAll('input[type="radio"]').forEach(radio => {
                    radio.checked = false;
                });
                document.getElementById('infoEnfoque').classList.add('hidden');
                document.getElementById('documentoFinal').classList.add('hidden');
                document.getElementById('vistaPrevia').classList.add('hidden');
                document.querySelectorAll('.feedback-box').forEach(box => {
                    box.classList.remove('show');
                });
                document.querySelector('.form-area').style.display = 'block';
                
                // Limpiar almacenamiento espec√≠fico del usuario
                localStorage.removeItem(getUserStorageKey());
                
                actualizarProgreso();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // Verificar sesi√≥n al cargar la p√°gina
        checkSession();
    </script>
</body>
</html>